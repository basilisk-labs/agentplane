---
title: "Release and publishing"
description: "Patch release flow, CI parity checks, and GitHub-only npm publish with provenance."
---

## Release policy

- Versioning follows SemVer.
- `agentplane` and `@agentplaneorg/core` release together at the same version.
- `packages/agentplane` dependency `@agentplaneorg/core` must match the same release version exactly.
- Patch bump is default automation path.
- Minor/major bump requires explicit approval.

## Notes policy

Every release requires notes in `docs/releases/vX.Y.Z.md`.

Requirements:

- English text
- at least one bullet
- no fixed maximum bullet count
- human-readable summary, not raw git log dump

## Standard flow

1. Generate release plan:

```bash
agentplane release plan
```

2. Draft notes from plan artifacts.
3. Run local release gate (must match publish prerequisites):

```bash
bun run release:prepublish
```

Optional fast parity check before the full gate:

```bash
bun run release:parity
```

4. Apply release and publish (mandatory):

```bash
AGENTPLANE_RELEASE_DRY_RUN=1 agentplane release apply
```

5. Real release:

```bash
agentplane release apply --push --yes
```

## What `release:prepublish` covers

`bun run release:prepublish` includes:

- `release:ci-check`:
- format check
- schema sync check
- agent template sync check
- build
- lint
- full test suite
- `release:check`:
- package builds
- npm dry-run pack for both packages

## Publishing policy

npm publish is GitHub-only.
Local `npm publish` is blocked by `prepublishOnly` through `scripts/enforce-github-publish.mjs`.

GitHub workflow `Publish to npm`:

- runs automatically on `main` when release candidate inputs change:
- `packages/core/package.json`
- `packages/agentplane/package.json`
- `docs/releases/**`
- uses OIDC trusted publishing
- sets provenance
- waits for green `Core CI` and `Docs CI` workflows for the exact target commit SHA
- validates notes and version/tag parity
- validates workspace parity (`core`, `agentplane`, and `@agentplaneorg/core` dependency)
- runs release-specific checks (`release:check`, release notes/version validation, origin tag existence)
- publishes `@agentplaneorg/core` first, then `agentplane`
- uses detect-and-skip logic for already-published versions to tolerate reruns

`Pre-publish Checks` workflow remains available as a manual matrix gate (`workflow_dispatch`) for explicit validation runs.

## Provenance requirements

Both packages set:

- `publishConfig.access = public`
- `publishConfig.provenance = true`

Trusted publishing must be configured in npm for repository workflow identity.

## Failure points and fixes

- `release apply --push` blocked:
- run `bun run release:prepublish` and fix failures
- Tag/version mismatch:
- ensure `vX.Y.Z` matches package versions and run `bun run release:parity`
- Package already published:
- bump to next patch and regenerate notes
- Publish workflow fails after partial publish:
- rerun workflow, idempotent checks should skip already-published packages

## Post-release checks

- verify npm versions for both packages
- verify GitHub release body matches `docs/releases/vX.Y.Z.md`
- verify upgrade bundle artifacts exist in release assets
