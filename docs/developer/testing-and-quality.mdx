---
title: "Testing and quality"
description: "How to run tests, lint, typecheck, and enforce quality gates."
---

## Local checks

From repo root:

```bash
bun install
bun run format:check
bun run schemas:check
bun run agents:check
bun run lint
bun run typecheck
bun run test:fast
```

If you run the repo-local CLI entrypoint (`node packages/agentplane/bin/agentplane.js ...`),
the CLI executes from `dist/`. Rebuild after source changes:

```bash
bun run --filter=@agentplaneorg/core build
bun run --filter=agentplane build
```

For a full run (including slower CLI integration tests):

```bash
bun run test:full
```

To run only the CLI integration tests (without the slower smoke test):

```bash
bun run test:cli
```

To run the critical pre-push suite (fast, real git, separate-process CLI e2e checks):

```bash
bun run test:critical
```

To run the faster CLI unit-ish suites (core + recipes):

```bash
bun run test:cli:unit
```

To run specific CLI suites:

```bash
bun run test:cli:core
bun run test:cli:recipes
bun run test:cli:scenario
```

To run the CLI smoke test (slowest end-to-end path):

```bash
bun run test:cli:smoke
```

To run the slow CLI suites together (scenario + smoke):

```bash
bun run test:cli:slow
```

To run package-scoped unit tests:

```bash
bun run test:agentplane
bun run test:core
bun run test:recipes
bun run test:testkit
```

## Package-specific checks

```bash
bun run --filter=agentplane build
bun run test:fast
```

## CI scoping (internal)

The repo includes a helper script that runs checks on a single scope:

```bash
node scripts/ci-scope.mjs --scope agentplane
```

Scopes: `agentplane`, `core`, `recipes`, `spec`, `testkit`.

This is intended for CI/local optimization; it is not part of the public CLI.

## Git hooks

Git hooks are a required quality gate for this repo. Do not bypass them.

```bash
bun run hooks:install
```

By default, hooks run:

- `commit-msg`: commit subject enforcement:
  - Task commits: `<emoji> <TASK_SUFFIX> <scope>: <summary>`
  - Non-task commits: `<emoji> <scope>: <summary>` (optional explicit `DEV` suffix allowed)
  - Status/comment-driven task commits derive `<emoji>` from the executor agent id and enforce it via `AGENTPLANE_AGENT_ID`
  - Finish commits must use `âœ…` (enforced via `AGENTPLANE_STATUS_TO=DONE`)
- `pre-commit`: format + lint + `test:precommit`
- `pre-push`: release notes check + `test:critical`. `test:full` runs automatically for tag pushes (release flow) or when `AGENTPLANE_HOOKS_RELEASE=1`/`AGENTPLANE_HOOKS_FULL=1`.

If a hook fails, fix the issue instead of skipping the hook.

## CI

On PRs and on pushes to `main`, CI runs:

- `bun run format:check`
- `bun run schemas:check`
- `bun run agents:check`
- `bun run build`
- `bun run lint`
- `bun run test:fast`
- `bun run test:critical`
- significant coverage guard job

## Coverage and parity tests

- CLI tests live under `packages/agentplane/src/cli/` and `packages/agentplane/src/commands/`.
- Significant-file coverage policy is checked by `bun run coverage:significant`.
- Release-time parity checks are enforced by `bun run release:prepublish`.
