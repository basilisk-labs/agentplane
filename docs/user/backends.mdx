---
title: "Backends deep dive"
description: "How task backends work, how they store data, and how sync behaves."
---

## Overview

A backend defines where tasks are stored and how synchronization happens. Backends are first-class CLI features (not recipes). The CLI loads the configured backend from `.agentplane/config.json` and routes all task commands through it.

## Local backend

- Stores tasks under `.agentplane/tasks/` as structured READMEs.
- Exports snapshots to `.agentplane/tasks.json` for integrations.
- Supports task docs, comments, and metadata enforcement.

## Remote backends

Remote backends (for example Redmine) are optional and should be configured explicitly. They typically include:

- Connection settings (URL, API key, project).
- Custom field mappings for task metadata.
- Sync direction and conflict policy.

## Redmine backend

The Redmine backend requires explicit configuration and custom fields to preserve task metadata.

### Redmine setup (required fields and config)

Redmine requires custom fields to preserve task metadata. Without them, tags/priority/owner may be lost and task docs cannot be stored.

### 1) Redmine project prerequisites

- Create a Redmine project and generate an API key for the service account.
- Ensure the account can read/write issues in the target project.

### 2) Required custom fields

Create the following Redmine custom fields and note their numeric IDs:

- `task_id` (required). Recommended type: Text.
- `doc` (required if you want task docs). Recommended type: Text.
- `doc_version` (required if you want task docs). Recommended type: Text or Integer.
- `doc_updated_at` (required if you want task docs). Recommended type: Text.
- `doc_updated_by` (required if you want task docs). Recommended type: Text.

### 3) Environment variables

Set these in `.env` (the CLI reads them on startup):

- `CODEXSWARM_REDMINE_URL`
- `CODEXSWARM_REDMINE_API_KEY`
- `CODEXSWARM_REDMINE_PROJECT_ID`
- `CODEXSWARM_REDMINE_ASSIGNEE_ID` (optional)
- `CODEXSWARM_REDMINE_OWNER` or `CODEXSWARM_REDMINE_OWNER_AGENT` (optional)
- `CODEXSWARM_REDMINE_CUSTOM_FIELDS_TASK_ID`
- `CODEXSWARM_REDMINE_CUSTOM_FIELDS_DOC` (required for docs)
- `CODEXSWARM_REDMINE_CUSTOM_FIELDS_DOC_VERSION` (required for docs)
- `CODEXSWARM_REDMINE_CUSTOM_FIELDS_DOC_UPDATED_AT` (required for docs)
- `CODEXSWARM_REDMINE_CUSTOM_FIELDS_DOC_UPDATED_BY` (required for docs)
- `CODEXSWARM_REDMINE_BATCH_SIZE` (optional)
- `CODEXSWARM_REDMINE_BATCH_PAUSE` (optional)

### 4) Backend config example

```json
{
  "id": "redmine",
  "version": 1,
  "settings": {
    "url": "https://redmine.example",
    "api_key": "replace-me",
    "project_id": "replace-me",
    "owner_agent": "REDMINE",
    "custom_fields": {
      "task_id": 1,
      "doc": 2,
      "doc_version": 3,
      "doc_updated_at": 4,
      "doc_updated_by": 5
    },
    "batch_size": 20,
    "batch_pause": 0.5
  }
}
```

### 5) Full parity with local backend (extra fields + mapping)

To reach full parity with the local backend, add custom fields for the remaining metadata and map them in the backend:

- `tags` (Text). Store comma-separated tag values.
- `priority` (Text or Integer). Store the task priority (`low|normal|med|high`).
- `owner` (Text). Store the task owner/agent id.

Then update the Redmine backend mapping to read/write these custom fields and point their IDs in `.env`. Without this code mapping, Redmine will not retain these values even if the fields exist.

## Sync model

Use explicit sync commands:

```bash
agentplane sync <backend> --direction pull
agentplane sync <backend> --direction push --yes
```

The CLI may maintain a local cache and falls back to it when remote services are unavailable.

## Conflict strategies

- `diff` — report differences without overwriting.
- `prefer-local` — local state wins.
- `prefer-remote` — remote state wins.
- `fail` — abort when conflicts exist.

## Backend configuration

Backend config file path is stored in `.agentplane/config.json` under `tasks_backend.config_path`. During init you can choose `--backend local|redmine`, and you can switch later by updating this path.

### Backend config format (standardized)

Each backend config is a JSON file with a stable shape:

```json
{
  "id": "local",
  "version": 1,
  "settings": {
    "dir": ".agentplane/tasks"
  }
}
```

Legacy fields like `module`/`class` are ignored by the loader.

Example:

```json
{
  "tasks_backend": {
    "config_path": ".agentplane/backends/local/backend.json"
  }
}
```

## Adding a backend

- Implement the backend interface in the CLI.
- Provide a config template under `.agentplane/backends/<id>/`.
- Document required fields and safety caveats.
